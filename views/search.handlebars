<div class="container">
    <div class="row">
        <div class="col-md" id="search-box">
            <div class="card bg-default">
                <h5 class="card-header">Search for a Book</h5>
                <div class="card-body">
                    <p class="card-text"></p>
                    <form>
                        <div class="form-group">
                            <label for="isbn">ISBN-10 Number</label> <input aria-describedby="isbnHelp" class="form-control" id="isbn-input" placeholder="9781405080583" type="text"> <small class="form-text text-muted" id="emailHelp">Must be 10 digits long</small>
                        </div>
                        <div class="form-group">
                            <label for="title">Book Title</label> <input class="form-control" id="title-input" placeholder="Doctor No" type="text">
                        </div><button class="btn btn-info" id="bookSearch" type="submit">Search</button>
                    </form>
                    <p></p>
                </div>
            </div>
            <div>
                <h3>Book Search Results:</h3>
                <ul class="list-group" id="book-info"></ul>
            </div>
            <div aria-hidden="true" aria-labelledby="bookModal" class="modal fade" id="bookModal" role="dialog" tabindex="-1">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"></h5><button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            ...
                        </div>
                        <div class="modal-footer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="/styles/search.css" media="screen" charset="utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script type="text/javascript">
$('#bookSearch').click(function (event) {
        event.preventDefault();
        console.log('bookSearch button clicked');

        let input = {};
        input.isbn = $("#isbn-input").val();
        input.title = $("#title-input").val();


  let queryURL = "https://www.googleapis.com/books/v1/volumes?q=isbn:" + input.isbn + "&key=" + "AIzaSyDdxaUEx5j0RsXLGcsviwOwOVMZ2QBLLBo"
  $.ajax({
      url: queryURL,
      type: "GET"
  }).then(function (result) {
      $("#book-info").empty()
      console.log(result.items[0].volumeInfo.title)
      var books = result.items
      for (i=0;i<books.length;i++) {
          console.log("tick")
          var $li = $("<li>").text(books[i].volumeInfo.title).addClass("list-group-item")
        var $button = $("<button>").addClass("btn btn-primary select float-right").text("Select").attr("data-target", ".modal").attr("data-toggle", "modal").attr("data-id", books[i].id)
        $li.append($button)
      $("#book-info").append($li)
      }
     // console.log(result.items[0].volumeInfo.title)
  //    console.log(result)
    //  console.log("right here");
//          $.ajax({
//        type: 'POST',
//      data: JSON.stringify(result),
  //    contentType: 'application/json',
    //  url: 'http://localhost:3000/result',
      //success: function (result) {
        //  console.log(result)
          //console.log('sent to server');
    //  }
  });
  })

var downloadBook = function(bookID) {
var queryURL =
  "https://www.googleapis.com/books/v1/volumes/" +
  bookID
//   + "?key=" +
//      "AIzaSyDdxaUEx5j0RsXLGcsviwOwOVMZ2QBLLBo";
return $.ajax({
  url: queryURL,
  type: "GET",
  success: function (result) {
    console.log("book info downloaded!");
  }
}).then(function(data) {
    console.log(data)
});
}

var bookPUSH = function(bookData) {
return $.ajax({
  headers: {
    "Content-Type": "application/json"
  },
  type: "POST",
  url: "api/books",
  data: JSON.stringify(bookData),
  success: function (result) {
    console.log("book saved to server");
}
});
}


$(document).on("click", ".select", function() {
var bookID = $(this).attr("data-id");
console.log(bookID)
var queryURL =
  "https://www.googleapis.com/books/v1/volumes/" +
  bookID
//   + "?key=" +
//      "AIzaSyDdxaUEx5j0RsXLGcsviwOwOVMZ2QBLLBo";
$.ajax({
  url: queryURL,
  type: "GET",
  success: function (result) {
    console.log("book info downloaded!");
  }
}).then(function(result) {
  $(".modal-title").empty()
  $(".modal-body").empty()
  $(".modal-footer").empty()
$(".modal-title").text(result.volumeInfo.title)

var $div = $("<div>")
.html(result.volumeInfo.description);

var $buttonSave = $("<button>")
.addClass("btn btn-primary float-right save")
.attr("data-id",result.id)
.text("Save");
var $buttonExit = $("<button>")
.addClass("btn btn-primary float-right exit")
.attr("data-dismiss","modal")
.text("Exit");

$(".modal-footer").append($buttonSave).append($buttonExit);
    $(".modal-body").append($div)
})
})

$(document).on("click", ".save", function(){
var ID = $(this).attr("data-id");
var queryURL = "https://www.googleapis.com/books/v1/volumes/" + ID
//   + "?key=" +
//      "AIzaSyDdxaUEx5j0RsXLGcsviwOwOVMZ2QBLLBo";
$.ajax({
  url: queryURL,
  type: "GET",
  success: function (result) {
    console.log("book info downloaded!");
  }
}).then(function(result) {
var bookSubmission = {
  title: data.volumeInfo.title,
  purchase_link: data.saleInfo.buyLink,
  image: data.imageLinks.thumbnail,
  authors: data.volumeInfo.authors.join(","),
  description: data.volumeInfo.description,
  pageCount: data.volumeInfo.pagecount,
  rating: data.volumeInfo.averageRating,
  price: data.saleInfo.listPrice.amount,
  isbn: data.volumeInfo.industryIdentifiers[1].identifier,
}
$.ajax({
  headers: {
    "Content-Type": "application/json"
  },
  type: "POST",
  url: "api/books",
  data: JSON.stringify(bookSubmission),
  success: function (result) {
    console.log("book saved to server");
  }
})
})
})
</script>

